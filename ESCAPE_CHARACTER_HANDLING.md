# ğŸ”§ è½¬ä¹‰ç¬¦å¤„ç†å®ç°

## ğŸ“‹ é—®é¢˜åˆ†æ

åœ¨ `sseMatch[2]` ä¸­ï¼Œæ•°æ®å†…å®¹åŒ…å«è½¬ä¹‰ç¬¦ï¼Œéœ€è¦æ­£ç¡®å¤„ç†æ‰èƒ½è¾“å‡ºæ­£ç¡®çš„JSONæ ¼å¼ã€‚

### åŸå§‹æ•°æ®ä¸­çš„è½¬ä¹‰ç¬¦ï¼š
```
{\"thread_id\":\"93M9L-PdLyUvbHQNJ6poF\",\"content\":\"æˆ‘æ¥\"}
```

### éœ€è¦å¤„ç†çš„è½¬ä¹‰ç¬¦ç±»å‹ï¼š
- `\"` â†’ `"` (è½¬ä¹‰çš„å¼•å·)
- `\\n` â†’ `\n` (è½¬ä¹‰çš„æ¢è¡Œç¬¦)
- `\\\\` â†’ `\` (è½¬ä¹‰çš„åæ–œæ )

## âœ… è§£å†³æ–¹æ¡ˆ

### è½¬ä¹‰ç¬¦å¤„ç†é€»è¾‘ï¼š
```javascript
// å¤„ç†è½¬ä¹‰ç¬¦ï¼šè¿˜åŸæ‰€æœ‰è½¬ä¹‰å­—ç¬¦
dataContent = dataContent
  .replace(/\\"/g, '"')  // è½¬ä¹‰çš„å¼•å·
  .replace(/\\n/g, '\n') // è½¬ä¹‰çš„æ¢è¡Œç¬¦
  .replace(/\\\\/g, '\\'); // è½¬ä¹‰çš„åæ–œæ 
```

### å®Œæ•´çš„æ•°æ®å¤„ç†æµç¨‹ï¼š
```javascript
// è§£æSSEæ¶ˆæ¯ï¼šæå–eventå’Œdataéƒ¨åˆ†
const sseMatch = line.match(/"event: (\w+)\\ndata: ({.*?})\\n\\n",/);
if (sseMatch) {
  const eventType = sseMatch[1];
  let dataContent = sseMatch[2];
  
  // å¤„ç†è½¬ä¹‰ç¬¦ï¼šè¿˜åŸæ‰€æœ‰è½¬ä¹‰å­—ç¬¦
  dataContent = dataContent
    .replace(/\\"/g, '"')  // è½¬ä¹‰çš„å¼•å·
    .replace(/\\n/g, '\n') // è½¬ä¹‰çš„æ¢è¡Œç¬¦
    .replace(/\\\\/g, '\\'); // è½¬ä¹‰çš„åæ–œæ 
  
  // è¾“å‡ºæ ‡å‡†SSEæ ¼å¼
  res.write(`event: ${eventType}\n\n`);
  res.write(`data: ${dataContent}\n\n`);
}
```

## ğŸ¯ å¤„ç†ç»“æœ

### å¤„ç†å‰ï¼ˆåŒ…å«è½¬ä¹‰ç¬¦ï¼‰ï¼š
```
data: {\"thread_id\":\"93M9L-PdLyUvbHQNJ6poF\",\"content\":\"æˆ‘æ¥\"}
```

### å¤„ç†åï¼ˆæ­£ç¡®JSONæ ¼å¼ï¼‰ï¼š
```
data: {"thread_id":"93M9L-PdLyUvbHQNJ6poF","content":"æˆ‘æ¥"}
```

## ğŸ“Š æµ‹è¯•éªŒè¯

### 1. è½¬ä¹‰ç¬¦å¤„ç†æµ‹è¯•ï¼š
```bash
curl -s "http://localhost:8000/api/chat/stream/lmpI42ID_JQ9V5MLppjk1?speed=fast&baseDelay=10"
```

**è¾“å‡ºç»“æœ**ï¼š
```
event: message_chunk

data: {"thread_id":"93M9L-PdLyUvbHQNJ6poF","content":"æˆ‘æ¥"}

event: message_chunk

data: {"thread_id":"93M9L-PdLyUvbHQNJ6poF","content":"å¸®"}
```

### 2. æ ¼å¼éªŒè¯ï¼š
- âœ… è½¬ä¹‰å¼•å·æ­£ç¡®è¿˜åŸ
- âœ… JSONæ ¼å¼æ­£ç¡®
- âœ… SSEæ ¼å¼æ ‡å‡†
- âœ… åŠ¨æ€å»¶æ—¶æ­£å¸¸å·¥ä½œ

## ğŸ‰ å®ç°æ€»ç»“

### âœ… æˆåŠŸå¤„ç†ï¼š

1. **è½¬ä¹‰å¼•å·**ï¼š`\"` â†’ `"`
2. **è½¬ä¹‰æ¢è¡Œç¬¦**ï¼š`\\n` â†’ `\n`
3. **è½¬ä¹‰åæ–œæ **ï¼š`\\\\` â†’ `\`
4. **JSONæ ¼å¼**ï¼šè¾“å‡ºæ­£ç¡®çš„JSONæ ¼å¼
5. **SSEæ ‡å‡†**ï¼šç¬¦åˆSSEè§„èŒƒ

### ğŸ¯ ç°åœ¨å¯ä»¥ï¼š

- âœ… æ­£ç¡®å¤„ç†æ‰€æœ‰è½¬ä¹‰ç¬¦
- âœ… è¾“å‡ºæ ‡å‡†JSONæ ¼å¼
- âœ… ä¿æŒSSEæ ‡å‡†æ ¼å¼
- âœ… ç»´æŒæ‰€æœ‰åŠ¨æ€å»¶æ—¶åŠŸèƒ½
- âœ… æ”¯æŒå®æ—¶æµå¼ä¼ è¾“

**è½¬ä¹‰ç¬¦å¤„ç†å®Œæˆï¼ç°åœ¨æ‚¨çš„æµå¼è¾“å‡ºæœåŠ¡å¯ä»¥æ­£ç¡®å¤„ç† `sseMatch[2]` ä¸­çš„è½¬ä¹‰ç¬¦ï¼Œè¾“å‡ºæ ‡å‡†çš„JSONæ ¼å¼ï¼** ğŸ¯
